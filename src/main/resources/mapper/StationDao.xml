<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.cbb.wasteRecovery.dao.StationDao">
<resultMap type="org.cbb.wasteRecovery.bean.Station" id="tion">
  <id property="id" column="id"/>
  <result property="detailed_address" column="detailed_address"/>
  <result property="name" column="name"/>
  <result property="address" column="address"/>
  <result property="locationY" column="locationY"/>
  <result property="locationX" column="locationX"/>

</resultMap>

<resultMap type="org.cbb.wasteRecovery.bean.Station" id="tion1">
        <id property="id" column="id"/>
        <result property="detailed_address" column="detailed_address"/>
        <result property="name" column="name"/>
        <result property="address" column="address"/>
        <result property="locationY" column="locationY"/>
        <result property="locationX" column="locationX"/>
       <collection property="collectorList" resultMap="org.cbb.wasteRecovery.dao.CollectorDao.Collect1"/>
       <collection property="consultantList" resultMap="org.cbb.wasteRecovery.dao.ConsultantDao.Consultant1"/>
</resultMap>


    <sql id="columns">t.id,t.staid,t.password,t.username,st.name,st.address,st.detailed_address,c.realName,c.sex,c.password,c.phoneNumber,c.photo,c.idCardNum,c.idCardFrontPhoto,c.idCardBackPhoto,c.createTime,c.avater,c.staid,c.state,c.volume</sql>


    <select id="selectById" resultMap="tion1" parameterType="int">
        select <include refid="columns"/>
        from (station st
        INNER JOIN consultant t ON st.id=t.staid)INNER JOIN collector c
        ON st.id=c.staid
        where
           st.id=#{id}
       
        
    </select>


    
    <select id="selectByAdd" resultMap="tion1" >
       select <include refid="columns"/>
        from (station st
        INNER JOIN consultant t ON st.id=t.staid)INNER JOIN collector c
         ON st.id=c.staid
        where
        st.address like '%' #{address} '%'
        order BY st.id
        limit #{offset},#{limit}
       
        
    </select>
    
    <select id="selectByName" resultMap="tion1">
       select <include refid="columns"/>
        from (station st
        INNER JOIN consultant t ON st.id=t.staid)INNER JOIN collector c
         ON st.id=c.staid
        where
           st.name=#{name}
        order BY st.id
        limit #{offset},#{limit}
       
        
    </select>

    <insert id="insertStaion">

        insert  into station(name,address,detailed_address,position)
        values (#{name},#{address},#{detailed_address},point(#{locationX},#{locationY}))
    </insert>


    <delete id="deleteStation">
        delete
        from
        station
        where
        id=#{id}

    </delete>
    
    <update id="updateData">
       
        update
          station
        set

          name = #{name},
         address = #{address},
         detailed_address = #{detailed_address}

        where
          id = #{id}
      
    </update>
    
</mapper>