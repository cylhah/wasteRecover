CREATE DATABASE replatform

CREATE TABLE `station` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `address` varchar(255) DEFAULT NULL COMMENT '地址',
  `detailed_address` varchar(255) DEFAULT NULL COMMENT '详细地址',
  `position` point NOT NULL,
  PRIMARY KEY (`id`),
  SPATIAL KEY `sta_pos` (`position`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `consultant` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `staid` int(10) unsigned DEFAULT NULL COMMENT '公司id',
  `username` varchar(255) DEFAULT NULL,
  `password` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `ad_staid` (`staid`) USING BTREE,
  KEY `ad_nameAndPass` (`username`,`password`),
  CONSTRAINT `ad_staid` FOREIGN KEY (`staid`) REFERENCES `station` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `collector` (
  `id` int(11) unsigned auto_increment NOT NULL,
  `realName` varchar(255) DEFAULT NULL COMMENT '真实姓名',
  `sex` char(255) DEFAULT NULL,
  `avater` varchar(255) DEFAULT NULL COMMENT '头像',
  `phoneNumber` varchar(255) NOT NULL,
  `password` varchar(255) DEFAULT NULL,
  `photo` varchar(255) DEFAULT NULL COMMENT '本人照片',
  `idCardNum` varchar(255) DEFAULT NULL COMMENT '身份证号',
  `idCardFrontPhoto` varchar(255) DEFAULT NULL COMMENT '身份证正面地址',
  `idCardBackPhoto` varchar(255) DEFAULT NULL COMMENT '身份证背面地址',
  `volume` int(10) unsigned DEFAULT NULL COMMENT '成交量',
  `createTime` datetime DEFAULT NULL,
  `staid` int(10) unsigned NOT NULL,
  `state` int(10) unsigned DEFAULT NULL COMMENT '非法用户:0,正常用户:1',
  PRIMARY KEY (`id`),
  KEY `c_name` (`realName`),
  KEY `c_phoneNumber` (`phoneNumber`),
  KEY `c_idCard` (`idCardNum`),
  KEY `c_staid` (`staid`),
  CONSTRAINT `c_staid` FOREIGN KEY (`staid`) REFERENCES `station` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `community` (
  `id` int(11) unsigned auto_increment NOT NULL,
  `address` varchar(255) DEFAULT NULL COMMENT '小区地址',
  `cid` int(11) unsigned DEFAULT NULL COMMENT '回收员id',
  `name` varchar(255) DEFAULT NULL COMMENT '小区名',
  PRIMARY KEY (`id`),
  KEY `comm_cid` (`cid`),
  CONSTRAINT `comm_cid` FOREIGN KEY (`cid`) REFERENCES `collector` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `user` (
  `openid` varchar(255) NOT NULL,
  `avater` varchar(255) DEFAULT NULL COMMENT '头像地址',
  `state` int(11) unsigned zerofill DEFAULT '00000000000' COMMENT '非法用户:0,正常用户:1' ,
  PRIMARY KEY (`openid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;



CREATE TABLE `bankaccount` (
  `id` bigint(20) unsigned auto_increment NOT NULL,
  `uid` varchar(255) DEFAULT NULL,
  `account` varchar(255) DEFAULT NULL COMMENT '银行卡号',
  `bank_code` int(255) unsigned DEFAULT NULL COMMENT '银行id',
  `username` varchar(255) DEFAULT NULL COMMENT '银行卡用户名',
  PRIMARY KEY (`id`),
  KEY `ba_uid` (`uid`),
  CONSTRAINT `ba_uid` FOREIGN KEY (`uid`) REFERENCES `user` (`openid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `useraddress` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `uid` varchar(255) DEFAULT NULL,
  `address` varchar(255) DEFAULT NULL COMMENT '附近坐标',
  `position` point NOT NULL COMMENT '坐标',
  `detail` varchar(255) DEFAULT NULL COMMENT '详细地址',
  `geohash` varchar(12) DEFAULT NULL,
  `phoneNumber` varchar(255) DEFAULT NULL COMMENT '收货人手机号',
  `name` varchar(255) DEFAULT NULL COMMENT '收货人姓名',
  `community_id` int(11) unsigned DEFAULT NULL COMMENT '归属小区',
  PRIMARY KEY (`id`),
  KEY `ua_geohash` (`geohash`),
  SPATIAL KEY `ua_pos` (`position`),
  KEY `ua_commid` (`community_id`),
  KEY `ua_uid` (`uid`),
  CONSTRAINT `ua_commid` FOREIGN KEY (`community_id`) REFERENCES `community` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `ua_uid` FOREIGN KEY (`uid`) REFERENCES `user` (`openid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `orderform` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT,
  `uid` varchar(255) NOT NULL COMMENT '用户id',
  `cid` int(11) unsigned DEFAULT NULL COMMENT '完成该订单的回收员id',
  `aid` bigint(20) unsigned NOT NULL COMMENT '地址id',
  `state` tinyint(4) DEFAULT NULL COMMENT '已提交:1,已完成:2,请求更改:3,请求取消:4',
  `weight` double DEFAULT NULL COMMENT '总重量',
  `createTime` timestamp NULL DEFAULT NULL,
  `appointTime` timestamp NULL DEFAULT NULL COMMENT '预约时间',
  `updateTime` timestamp NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `price` double(10,2) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `o_state` (`state`),
  KEY `o_uid` (`uid`),
  KEY `o_cid` (`cid`),
  CONSTRAINT `o_cid` FOREIGN KEY (`cid`) REFERENCES `collector` (`id`),
  CONSTRAINT `o_uid` FOREIGN KEY (`uid`) REFERENCES `user` (`openid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `scrap` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
  `typename` varchar(255) NOT NULL COMMENT '种类id',
  `name` varchar(255) NOT NULL,
  `unitPrice` double(10,2) unsigned DEFAULT NULL COMMENT '对于用户的单价',
  `monthVolume` double DEFAULT NULL COMMENT '当月成交量',
  `totalVolume` double DEFAULT NULL COMMENT '总成交量',
  PRIMARY KEY (`id`),
  KEY `s_typeName` (`typename`)
  KEY `s_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `scrapmessage` (
  `oid` bigint(20) unsigned DEFAULT NULL COMMENT '订单id',
  `scrapid` int(10) unsigned DEFAULT NULL COMMENT '废品id',
  `weight` double unsigned DEFAULT NULL COMMENT '废品重量',
  `price` double unsigned DEFAULT NULL COMMENT '废品价格',
  primary key (oid, scrapid),
  KEY `sm_oid` (`oid`),
  KEY `sm_scrapid` (`scrapid`),
  CONSTRAINT `sm_oid` FOREIGN KEY (`oid`) REFERENCES `orderform` (`id`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `sm_scrapid` FOREIGN KEY (`scrapid`) REFERENCES `scrap` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

